中文 | [English Version](README.md)
# 心灵慰藉站(Project Soul-Comfort)

一个旨在为当代人提供理解、支持与鼓励的Web 应用。

## 💡 项目愿景 (Vision)

在这个快节奏、充满压力的社会中，我们相信每个人都需要一个可以获得片刻宁静、汲取精神力量的角落。本项目致力于成为一个温暖的港湾，通过精心筛选的文字和智能化的互动，为用户提供积极的情绪价值 ?

## 🚀 核心功能 (Core Features)

本网站计划实现以下核心功能：

1.  **每日一句(Daily Affirmation):** 网站的核心基础。用户每次访问，都能看到一句能引发思考或带来力量的句子。
2.  **AI 情感树洞 (Interactive Emotional Support):** 用户可以输入当下的情绪或想法，AI 将扮演一个充满同理心的倾听者，提供支持与积极引导。
3.  **吵架王模式(Argument King Mode):** 一个独特且有趣的功能。当用户在争论中没发挥好时，可以在此描述场景，AI 会帮助用户构思犀利、幽默且逻辑清晰。回击"策略。

## 🗺️ 开发路线图 (Development Roadmap)

我们将采用分阶段、迭代式的开发策略，并遵循**"先免费验证，后付费迭代** 的商业模式。

### **第一阶段 (Phase 1): 最小可行产 ?(MVP) - 免费**

*   **核心目标:** 搭建并上线一个高质量、免费使用的"每日一句"网站。
*   **商业目的:** 快速验证产品核心价值，积累早期用户和反馈，为后续迭代和商业化打下坚实基础。
*   **具体任务:**
    *   实现首页"每日一句的展示。
    *   创建内容分类页面，用于浏览所有句子。
    *   投入精力策划和筛选一批高质量的种子内容。
    *   设计简洁、美观、响应式 ?UI 界面。
    *   搭建 Supabase 数据库，用于存储和管理内容。

### **第二阶段 (Phase 2): 引入 AI 互动**

*   **目标:** 在免费版本基础上，集成 AI 模型，实 ?AI 情感树洞"功能。
*   **成本控制:** 为控 ?API 调用成本，可能会对匿名用户或所有用户设置每日免费使用次数限制 ?
*   **具体任务:**
    *   设计用户交互界面 ?
    *   编写后端 API 路由，用于安全调 ?AI 服务 ?
    *   设计并优 ?AI  ?Prompt，并加入必要的安全护栏 ?
    *   在界面上增加免责声明 ?

### **第三阶段 (Phase 3): 扩展特色功能**

*   **目标:** 上线"吵架 ?模式，形成产品独特的差异化优势 ?

### **第四阶段 (Phase 4): 商业化探 ?*

*   **目标:** 基于前序阶段积累的用户和数据，引入付费模式（如订阅制或按次付费） ?
*   **前提:** 只有当数据证明产品对用户有足够高的价值时，才启动此阶段 ?

## 🛠 ?技术栈 (Technology Stack)

*   **框架:** Next.js (App Router)
*   **语言:** TypeScript
*   **数据 ?后端:** Supabase
*   **UI 样式:** Tailwind CSS
*   **UI 组件:** Shadcn UI
*   **AI 服务:** OpenAI GPT API (或同类服 ? 阶段二引 ?
*   **部署:** Vercel

## ⚖️ 风险与考量 (Risks & Considerations)

在开发前，我们必须正视以下挑战：

1.  **内容质量:** 网站的价值高度依赖于内容的质量。必须投入精力策划和筛选能真正触动人心的原创性内容，避免陈词滥调 ?
2.  **AI 成本与责 ?** AI 功能上线后，API 调用会产生持续性费用，必须做好成本监控。更重要的是，作为提供情感支持的服务，我们有伦理和安全上的责任，必须设置清晰的免责声明和技术上的安全护栏，防止 AI 提供有害建议 ?
3.  **市场竞争:** 为在同类产品中脱颖而出，除了独特的功能（如"吵架 ?模式），还需要在 UI/UX 设计和品牌格调上做到卓越 ?

## 📝 未来优化建议 (Future Improvements)

### **内容迭代策略**
* **分类体系建设**：按主题（成长、挫折、人际关系等）、情感需求（鼓励、安慰、启发等）和生活场景（工作压力、学业挑战、人际冲突等）构建内容库
* **内容质量控制**：设立内容筛选标准，确保每句话都有思想深度和情感共 ?
* **定期更新机制**：建立每 ?每月内容更新计划，保持内容新鲜度
* **用户反馈收集**：实现内容评分系统，根据用户反馈优化内容 ?

### **付费模式设计**
* **分层会员体系** ?
  - 免费层：每日限量的名言访问，基础功能
  - 基础会员：完整内容库访问，有限次数的AI互动
  - 高级会员：无限AI互动，专属内容，高级功能
* **获取免费额度渠道** ?
  - 转介绍奖励：邀请好友注册获得免费使用额 ?
  - 活动参与：完成问卷、分享体验、提供反馈获得奖 ?
  - 内容贡献：提交高质量名言被采纳后获得奖励
* **技术实现要 ?* ?
  - 用户认证系统（注册、登录、账户管理）
  - 支付接口集成（订阅管理、交易记录）
  - 额度管理系统（使用统计、额度消耗与奖励 ?

### **伦理与安全保 ?*
* **免责声明设计** ?
  - 网站底部通用免责声明
  - 功能使用前的专门条款（尤其是AI互动功能 ?
  - 明确指出网站不能替代专业心理咨询
* **内容安全机制** ?
  - AI输出内容的审核过 ?
  - 敏感话题的识别与适当处理
  - 紧急情况（如自伤风险）的响应机 ?

### **创新功能构 ?*
* **个性化推荐系统**：基于用户情绪状态和历史互动推荐内容
* **情绪追踪日记**：记录用户情绪变化，提供可视化分 ?
* **社区支持功能**：匿名分享和互助，但有严格的内容审核
* **情境化内 ?*：根据时间、天气或特定事件推送相关内 ?
* **视觉呈现增强**：将名言与精美背景结合，支持分享到社交媒 ?
* **音频体验**：提供名言的语音朗读，配合舒缓背景音乐

## 💡 创意脑暴 ?(Brainstorming Area)

*这是一个记录我们未来可能实现的好点子的地方 ?

*   想法1: 增加一 ?冥想模式"，播放舒缓的音乐，并定时切换句子 ?
*   想法2: 用户可以将喜欢的句子生成一张精美的图片并下载分享 ?
*   (待补 ?..)

## ⚙️ 如何开始(Getting Started)

*(待补充项目启动和本地开发指 ?* 

---

## 航海日志 (Development Log)

### 节点 0：纯净的起 ?(Node Zero: The Clean Slate) - 2025-06-27

**状态：** 一个最基础、最标准的、单语言 ?Next.js 应用 ?

**描述 ?*
在经历了多次为项目集 ?`next-intl` 国际化库的失败尝试后，我们决定推翻所有之前的改动，进行一次彻底的"硬重 ?。我们移除了所有与 `next-intl` 相关的代码、配置、文件结构和依赖包，将项目恢复到了一 ?00%稳定、可预测 ?零号基地" ?

这个节点是项目最重要的基石。它能成功运行，并在 `http://localhost:3000` 正常显示页面，没有任何错误。它标志着我们所有底层配置（Next.js, TypeScript, Tailwind CSS）的正确性，为后续所有功能的开发提供了一个绝对可靠的起点 ?

**核心决策 ?*
*   **推倒重建：** 明确了在遇到复杂、状态混乱的错误时，"硬重 ?是比"打补 ?更优的解决方案 ?
*   **确立原则 ?* 基于这次的经验，我们确立 ?节点存档" ?清晰沟 ? ?自我审查"三大核心合作原则 ?

---

### 里程碑：项目初始 ?(Milestone: Project Initialization) - 2025-06-27

**状态：** 一个通过官方工具链初始化的、稳定可靠的项目骨架 ?

**描述:** 
成功清除了所有历史遗留问题，通过官方工具 ?(`create-next-app`, `shadcn-ui init`) 搭建了一个稳定、可靠的 Next.js (App Router), TypeScript, Tailwind CSS,  ?Shadcn UI 项目骨架。所有依赖均已安装，本地开发服务器 (`npm run dev`) 能够成功启动并渲染默认欢迎页面，无任何错误。项目地基正式完工 ?

**存档 ?(Git Commit):** `50a7f1a`

### 里程碑：国际化功能实 ?(Milestone: Internationalization) - 2025-06-27

**状态：** 成功实现中英文双语切换功能，网站可通过不同语言路径访问 ?

**描述:** 
成功配置和实现了基于 `next-intl` 的国际化功能。网站现在支持中 ?/zh)和英 ?/en)两种语言版本，可以通过URL路径前缀进行切换。采用了"基于浏览器设置的自动检 ?策略，同时确保了所有URL都包含明确的语言标识。翻译内容通过 JSON 文件管理，便于后续扩展和维护 ?

**技术要 ?**
- 使用 `next-intl` 库实现国际化路由和内容翻 ?
- 配置 `middleware.ts` 处理语言路由重定 ?
- 实现 `i18n.ts` 配置语言验证和消息加 ?
-  ?`app/[locale]/layout.tsx` 中集 ?`NextIntlClientProvider`
- 通过 `messages/` 目录下的 JSON 文件管理翻译内容

**存档 ?(Git Commit):** `cc9fac6`

**注意事项:** 
当前配置中存在一些关 ?`next-intl` API 即将过时的警告，这些不影响功能，但在未来版本中可能需要更新 ?

### 里程碑：每日一句功能实 ?(Milestone: Daily Quote Feature) - 2025-06-28

**状态：** 成功实现了网站核心功 ?每日一 ?，并解决了国际化配置问题 ?

**描述:** 
实现了网站的核心功能— ?每日一 ?随机名言展示系统。用户可以在主页上看到一条随机精选的名言，并通过刷新按钮获取新的名言。同时，网站支持中英文双语切换，用户可以通过顶部导航栏切换语言。解决了客户端组件和服务器组件交互问题以及国际化配置问题，确保网站稳定运行 ?

**技术要 ?**
- 实现了名言数据库和随机获取逻辑
- 创建了QuoteCard组件，支持随机刷新功 ?
- 修复了客户端组件和服务器组件交互问题
- 完善了国际化配置，支持中英文切换
- 优化了页面布局和基础样式

**遇到的挑战与解决方案:**
- **客户端组件交互问 ?** 由于Next.js的服务器组件和客户端组件分离，无法直接将服务器组件中的函数传递给客户端组件。解决方案是在客户端组件中直接导入和使用getRandomQuote函数 ?
- **国际化配置问 ?** next-intl的API变更导致requestLocale函数不可用。修改i18n/request.ts文件，直接使用传入的locale参数而非调用requestLocale函数 ?

**存档 ?(Git Commit):** `[将在提交后填写]`

**下一步计 ?** 
改进视觉设计，优化用户体验，扩充名言数据库，并开始规划AI树洞功能 ?

### 里程碑：AI情感树洞功能实现 (Milestone: AI Emotional Support Feature) - 2025-06-28

**状态：** 成功实现了网站第二大核心功能"AI情感树洞"，支持与AI进行情感交流 ?

**描述:** 
实现了网站的第二大核心功能— ?AI情感树洞"系统。用户可以通过主页入口进入树洞页面，与AI助手进行情感交流对话。系统支持流式响应，提供自然流畅的对话体验。同时，树洞功能也完全支持中英文双语，与网站整体国际化无缝集成 ?

**技术要 ?**
- 集成智谱AI的GLM-4模型API，实现高质量情感对话
- 创建完整的聊天界面组件，包括消息展示和输入区 ?
- 实现流式响应处理，提供实时打字效 ?
- 优化错误处理和加载状 ?
- 设计针对情感支持的系统提示词

**遇到的挑战与解决方案:**
- **API集成问题:** 尝试多种AI服务提供商，最终选择并成功集成智谱AI的GLM-4模型 ?
- **流式响应解析:** 针对智谱AI特定的响应格式，实现了自定义解析逻辑，确保正确显示流式文本 ?

**存档 ?(Git Commit):** `d876d52`

## 📋 待开发功 ?(Upcoming Features)

以下是计划在未来迭代中实现的功能 ?

1. **多种对话模式**
   - 实现"倾听" ?开 ? ?扎心"三种不同的AI对话模式
   - 添加模式切换界面，让用户可以根据需求选择不同的交互风 ?
   - 为每种模式设计专门的系统提示词，优化对话体验

2. **移动端体验优 ?*
   - 改进响应式布局，确保在各种屏幕尺寸上的最佳显示效 ?
   - 优化触摸交互，提升移动设备上的用户体 ?
   - 处理虚拟键盘弹出时的布局调整
   - 添加下拉刷新等移动端常见交互模式

3. **用户反馈机制**
   - 添加对话评分功能，让用户可以对AI回复进行评价
   - 实现详细反馈表单，收集用户对系统的建 ?
   - 开发反馈数据分析工具，指导产品改进方向

4. **名言收藏功能**
   - 允许用户收藏喜欢的名言
   - 创建收藏页面，方便用户查看和管理收藏内容
   - 添加分享功能，支持将名言分享到社交媒 ?

5. **内容扩充**
   - 扩充名言数据库，增加更多分类和内 ?
   - 实现按类别筛选名言的功 ?
   - 添加定期更新机制，保持内容新鲜度

## 🌐 网站部署计划和API保护措施

### 1. 网站部署步骤

1. **购买域名**
   - 选择简短、易记、与项目主题相关的域 ?
   - 推荐域名服务商：Namecheap、GoDaddy、阿里云 ?

2. **选择部署平台**
   - Vercel（推荐）：最适合Next.js项目，部署简 ?
   - Netlify：也支持Next.js，有良好的免费计 ?
   - Railway：适合需要后端服务的应用
   - 阿里 ?腾讯云：国内访问速度更快

3. **部署前准 ?*
   - 创建`.env.production`文件，添加生产环境变 ?
   - 确保API密钥安全存储，不要直接提交到代码仓库

4. **使用Vercel部署**
   - 创建Vercel账号并连接GitHub仓库
   - 配置环境变量（智谱AI API密钥等）
   - 点击部署按钮，等待自动构建和部署
   - 绑定自定义域 ?

5. **设置分析工具**
   - 添加Google Analytics或百度统计跟踪用户行 ?
   - 设置简单的错误监控（如Sentry ?

### 2. API保护措施

1. **验证码系 ?*
   - 在用户发送第一条消息前验证身份，防止API被恶意刷 ?
   - 推荐使用reCAPTCHA或hCaptcha服务
   - 实现方案：`npm install react-google-recaptcha`

2. **请求限制系统**
   - 基于IP地址的每日请求限制（如每IP每日10-20条消息）
   - 使用Redis或类似工具记录请求次 ?
   - 超出限制后提示付费或等待下一周期

3. **邀请链接系 ?*
   - 生成唯一邀请码/链接供早期用户测 ?
   - 被邀请用户获得额外的免费使用额度
   - 邀请者也可获得奖励（如额外使用次数）

4. **付费系统集成**
   - 使用Stripe或PayPal等支付服 ?
   - 设计简单的会员等级（基础/高级 ?
   - 高级会员获得更高的每日限额和额外功能

# Soul-Comfort Website (心灵慰藉 ?

A multilingual website offering emotional support through daily inspirational quotes and AI-powered conversation.

## Features

### 1. Daily Quote
- Displays random inspirational quotes
- Supports quote refresh
- Multilingual support (English/Chinese)

### 2. AI Tree Hole
- AI-powered emotional support chatbot
- Uses ZhipuAI's GLM-4 model
- Four interaction modes:
  - **Listening Mode**: AI focuses on listening and understanding without judgment
  - **Comfort Mode**: AI provides empathy, validation, and gentle encouragement
  - **Mind Challenge Mode**: AI helps identify thought patterns and offers alternative perspectives
  - **Debate Training Mode**: AI engages in respectful debate to strengthen reasoning skills

## Deployment Plan

### Domain and Hosting
1. Purchase domain name
2. Select hosting platform (Vercel, AWS, etc.)
3. Set up SSL certificate

### Environment Setup
1. Configure environment variables
2. Set up database connections
3. Deploy application

### API Protection
1. Implement CAPTCHA system
2. Set request limits
3. Consider invitation system
4. Integrate payment system

## Safety Measures
- Emotion monitoring
- Session limits
- Content filtering
- Emergency resources

## 最新进 ?(2025-06-29)

### 里程碑：AI情感树洞多模式功能实 ?

**状态：** 成功实现了AI情感树洞的多种交互模式，支持中英文双语 ?

**描述:** 
在AI树洞功能的基础上，增加了四种不同的交互模式，让用户可以根据需求选择不同的AI回应风格 ?

1. **倾听模式**：AI专注于倾听用户的想法，不给出评价或建议，只提供情绪价值和共鸣
2. **安慰模式**：AI提供温和的支持和建议，帮助用户感到安 ?
3. **思维挑战模式**：AI通过提出有益的质疑和新视角，帮助用户拓展思维
4. **辩论训练模式**：AI与用户进行有益的辩论，帮助锻炼思维能力和表达能 ?

**技术要 ?**
- 实现了模式选择器UI组件，支持中英文双语显示
- 为每种模式设计了专门的系统提示词，控制AI回复风格
- 实现了模式切换功能，可以在对话中随时切换模式
- 优化了模式选择的视觉反馈，让用户清楚当前选择的模 ?
- 为每种模式提供了多样化的回复，避免重 ?

**遇到的挑战与解决方案:**
- **国际化问 ?*：通过useEffect获取当前URL路径中的语言代码，实现了组件级别的国际化
- **模式切换视觉反馈**：通过条件样式类，为当前选中的模式按钮添加不同的样式
- **API依赖问题**：创建了模拟API响应，为不同模式和语言提供了多样化的回复模 ?

**下一步计 ?** 
- 集成真实AI API，替换模拟响 ?
- 优化移动端体 ?
- 添加用户反馈机制
- 实现对话历史保存功能

## 已知问题

### 1. 国际化文本显示问 ?

在英文界面下，部分UI元素（如模式选择器中 ?查看模式说明"按钮）仍然显示为中文。这是因为`usePathname()`钩子在某些情况下无法正确检测当前语言路径 ?

**临时解决方案 ?* 
- 在`components/ui/ModeSelector.tsx`中使用硬编码的英文文 ?
- 或者使用`window.location.href`直接检测URL中是否包含`/en/`

**待解决：**
- 找出`usePathname()`在Next.js国际化路由中工作不正常的原因
- 考虑使用Next.js提供的国际化上下文而不是手动检测路 ?

### 2. 智谱AI API响应处理中的JSON解析错误

在处理智谱AI的流式响应时，会在收到`data: [DONE]`消息时出现以下错误：

JSON解析错误: SyntaxError: Unexpected non-whitespace character after JSON at position 237

**当前处理：**
- 代码中已添加错误捕获逻辑，跳过无效的JSON数据
- 这个错误不影响聊天功能的正常使用，只是在控制台中会显示错误信息

**待改进：**
- 优化流式响应处理逻辑，更精确地处理不同类型的响应数据
- 考虑使用智谱AI官方提供的SDK示例代码处理流式响应
```

但即使保持现在的格式，错误信息也已经清晰地展示出来了，达到了记录问题的目的。
